stateDiagram-v2
	state "StorageDealUnknown" as 0
	state "StorageDealStaged" as 4
	state "StorageDealAwaitingPreCommit" as 5
	state "StorageDealSealing" as 6
	state "StorageDealFinalizing" as 7
	state "StorageDealActive" as 8
	state "StorageDealExpired" as 9
	state "StorageDealSlashed" as 10
	state "StorageDealRejecting" as 11
	state "StorageDealFailing" as 12
	state "StorageDealValidating" as 15
	state "StorageDealAcceptWait" as 16
	state "StorageDealTransferring" as 18
	state "StorageDealWaitingForData" as 19
	state "StorageDealVerifyData" as 20
	state "StorageDealReserveProviderFunds" as 21
	state "StorageDealProviderFunding" as 23
	state "StorageDealPublish" as 25
	state "StorageDealPublishing" as 26
	state "StorageDealError" as 27
	state "StorageDealProviderTransferRestart" as 28
	4 : On entry runs HandoffDeal
	5 : On entry runs VerifyDealPreCommitted
	6 : On entry runs VerifyDealActivated
	7 : On entry runs CleanupDeal
	8 : On entry runs WaitForDealCompletion
	11 : On entry runs RejectDeal
	12 : On entry runs FailDeal
	15 : On entry runs ValidateDealProposal
	16 : On entry runs DecideOnProposal
	20 : On entry runs VerifyData
	21 : On entry runs ReserveProviderFunds
	23 : On entry runs WaitForFunding
	25 : On entry runs PublishDeal
	26 : On entry runs WaitForPublish
	28 : On entry runs RestartDataTransfer
	[*] --> 0
	note right of 0
		The following events are not shown cause they can trigger from any state.

		ProviderEventNodeErrored - transitions state to StorageDealFailing
		ProviderEventRestart - does not transition state
	end note
	0 --> 15 : ProviderEventOpen
	15 --> 11 : ProviderEventDealRejected
	16 --> 11 : ProviderEventDealRejected
	20 --> 11 : ProviderEventDealRejected
	11 --> 12 : ProviderEventRejectionSent
	15 --> 16 : ProviderEventDealDeciding
	16 --> 19 : ProviderEventDataRequested
	18 --> 12 : ProviderEventDataTransferFailed
	19 --> 18 : ProviderEventDataTransferInitiated
	28 --> 12 : ProviderEventDataTransferRestartFailed
	19 --> 18 : ProviderEventDataTransferRestarted
	28 --> 18 : ProviderEventDataTransferRestarted
	18 --> 20 : ProviderEventDataTransferCompleted
	20 --> 12 : ProviderEventDataVerificationFailed
	19 --> 21 : ProviderEventVerifiedData
	20 --> 21 : ProviderEventVerifiedData
	21 --> 23 : ProviderEventFundingInitiated
	21 --> 25 : ProviderEventFunded
	23 --> 25 : ProviderEventFunded
	25 --> 26 : ProviderEventDealPublishInitiated
	26 --> 12 : ProviderEventDealPublishError
	11 --> 12 : ProviderEventSendResponseFailed
	16 --> 12 : ProviderEventSendResponseFailed
	26 --> 4 : ProviderEventDealPublished
	4 --> 12 : ProviderEventFileStoreErrored
	5 --> 12 : ProviderEventFileStoreErrored
	6 --> 12 : ProviderEventFileStoreErrored
	8 --> 12 : ProviderEventFileStoreErrored
	4 --> 12 : ProviderEventMultistoreErrored
	4 --> 12 : ProviderEventDealHandoffFailed
	4 --> 5 : ProviderEventDealHandedOff
	5 --> 12 : <invalid Value>
	5 --> 6 : <invalid Value>
	6 --> 12 : ProviderEventDealActivationFailed
	6 --> 7 : ProviderEventDealActivated
	7 --> 8 : ProviderEventCleanupFinished
	8 --> 10 : ProviderEventDealSlashed
	8 --> 9 : ProviderEventDealExpired
	8 --> 27 : ProviderEventDealCompletionFailed
	12 --> 27 : ProviderEventFailed
	11 --> 27 : ProviderEventRestart
	15 --> 27 : ProviderEventRestart
	16 --> 27 : ProviderEventRestart
	18 --> 28 : ProviderEventRestart
	21 --> 12 : ProviderEventTrackFundsFailed

	note left of 4 : The following events only record in this state.<br><br>ProviderEventPieceStoreErrored


	note left of 12 : The following events only record in this state.<br><br>ProviderEventFundsReleased


	note left of 18 : The following events only record in this state.<br><br>ProviderEventDataTransferRestarted<br>ProviderEventDataTransferStalled


	note left of 21 : The following events only record in this state.<br><br>ProviderEventFundsReserved


	note left of 26 : The following events only record in this state.<br><br>ProviderEventFundsReleased

	27 --> [*]
	10 --> [*]
	9 --> [*]
